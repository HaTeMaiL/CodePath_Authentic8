# Project 7 - WordPress Pentesting

Time spent: **10** hours spent in total

> Objective: Find, analyze, recreate, and document **three-five vulnerabilities** affecting an old version of WordPress
> Results: Find, analyze, recreate, and document **three vulnerabilities** affecting an old version of WordPress utilizing the following resources: Kali Linux, WPScan, Vagrant, and Gitbash as a terminal

## Pentesting Report

### 1. WordPress <= 4.9.4 - Application Denial of Service (DoS) (unpatched)
  - [ ] **Summary:** An application-level denial of service attack in the WordPress CMS platform possible through a single machine without the need of a massive amount of bandwidth (often seen in network-level DDoS attacks). This vulnerability is unpatched to this day and affects almost all version of WordPress. Much like other Denial of Service attacks, attackers can take advantage of this vulnerability to make a site unaccessible to users and therefore, deprive them of its resources.
    - Vulnerability types: Denial of Service
    - Tested in version: 4.2
    - Fixed in version: (unpatched)
  - [ ] GIF Walkthrough: 
    - [GIF](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/DoS.gif)
    ![XSS via Image](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/DoS.gif)
  - [ ] Steps to recreate: 
1. Download Python script (doser.py) through the terminal upsing wpget
2. Enter commands to run script and send an overwhelming number of requests to the target site utilizing their load-scripts.php file.
  - [ ] Affected source code:
    - [Vulnerable Code](https://your-wordpress-site.com/wp-admin/load-scripts.php?c=1&load=editor,common,user-profile,media-widgets,media-gallery)
  - [ ] Technical Details:
     - What is vulnerable and why?
       - However, to make "load-scripts.php" work on the admin login page (wp-login.php) before login, WordPress authors did not keep any authentication in place, eventually making the feature accessible to anyone.
       - Depending upon the plugins and modules you have installed, the load-scripts.php file selectively calls required JavaScript files by passing their names into the "load" parameter, separated by a comma. (ex: .../wp-admin/load-scripts.php?c=1&load=*editor,common,user-profile,media-widgets,media-gallery*)
       - While loading the website, the 'load-scripts.php' (mentioned in the head of the page) tries to find each JavaScript file name given in the URL, append their content into a single file and then send back it to the user's web browser
     - How the attack works
       - According to the bug bounty hunter, Barak Tawily, one can easily force "load-scripts.php" to call all possible JavaScript files (i.e., 181 scripts) in one go by passing their names into the above URL, making the targeted website slightly slow by consuming high CPU and server memory.
       - Although a single request would not be enough to take down the whole website for its visitors, Tawily used a proof-of-concept (PoC) python script, doser.py, which makes large numbers of concurrent requests to the same URL in an attempt to use up as much of the target servers CPU resources as possible and bring it down.
       - While this attack is not successful with any and every type of server, attackers with more bandwidth or a few bots can exploit this flaw to target big and popular WordPress websites as well.
    
### 2. WordPress 2.5-4.6 - Authenticated Stored Cross-Site Scripting via Image Filename
  - [ ] **Summary:** A Persistent Cross-Site Scripting (XSS) vulnerability allows for an attacker to utilize XSS techniques inthe image file name and when uploaded in WordPress, inject malicious JavaScript code into the application. Attackers can utilize this vulnerability to so a number of malicious acts, such as stealing session tokens or login credentials and then performing actions in their name and with their privileges.
    - Vulnerability types: Stored Cross-Site Scripting (XSS)
    - Tested in version: 4.2
    - Fixed in version: 4.2.10
  - [ ] GIF Walkthrough: 
     - [GIF](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/Image.gif)
     ![XSS via Image](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/Image.gif)
  - [ ] Steps to recreate for proof of concept (Must use Linux or Mac OS): 
1. Download or use any existing image file
2. Rename the image's file name with malicious JavaScript code with intent to obtain victim's cookies (ex: <img src=a onerror=alert(document.cookie)>)
3. Upload any image file (needs at minimum Author privileges)
4. View Attachment page (this shows PoC where the real-world attack would be where the admin clicks on the image from their media page)
  - [ ] Affected source code:
    - [Vulnerable Post](http://your-wordpress-site.com/?attachment_id=#)
    - [Security Release](https://wordpress.org/news/2016/09/wordpress-4-6-1-security-and-maintenance-release/)
  - [ ] Technical Details:
     - What is vulnerable and why?
       - WordPress performs insufficient validation on the file name of uploaded media types and in specific images. The file name of an image is used as image Title (meta) in so called ‘attachment pages’ (HTML). An attacker can exploit this vulnerability by crafting an image file name with Cross-Site Scripting payload and lure an admin into uploading the image with the malicious file name. 
     - How the attack works (hint: Social Engineering)
       - For the attack to succeed the following conditions have to be met:
        - A WordPress admin uploads a malicious image file requested by a user this admin trusts or a popular malicious image that was spread via social media. This involves social engineering. In the Proof of Concept the file name cengizhansahinsumofpwn<img src=a onerror=alert(document.cookie)>.jpg was used.
        - An attacker can now determine if the file name with which the malicious file is available on the WordPress site. With this information he can spread the URL to end users and the WordPress admin.
    
### 3. WordPress 3.6.0-4.7.2 - Authenticated Cross-Site Scripting (XSS) via Media File Metadata
  - [ ] **Summary:** Two Cross-Site Scripting (XSS) vulnerabilities are present in the playlist functionality of WordRess that allows for an attacker to exploit them by convincing an Editor or Administrator into uploading a malicious MP3 file. Still, once legitmately uploaded the issues can be triggered by a Contributor or higher using the playlist shortcode.
    - Vulnerability types: Stored Cross-Site Scripting (XSS)
    - Tested in version: 4.2
    - Fixed in version: 4.2.13
  - [ ] GIF Walkthrough: 
    - [GIF](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/Audio.gif)
    ![XSS via Image](https://github.com/HaTeMaiL/FacebookCodePathCourse_Authentic8/blob/master/WordPressPenTest/imgs/Audio.gif)
  - [ ] Steps to recreate for proof of concept: 
1. Upload xss.mp3 file (needs at minimum Editor privileges)
2. View Attachment page
  - [ ] Affected source code:
    - [Vulnerable Post](http://your-wordpress-site.com/?attachment_id=#)
    - [Security Release](https://wordpress.org/news/2017/03/wordpress-4-7-3-security-and-maintenance-release/)

## Assets

List any additional assets, such as scripts or files

1. WordPress <= 4.9.4 - Application Denial of Service (DoS) (unpatched)
    - [doser.py](https://github.com/quitten/doser.py)

3. WordPress 3.6.0-4.7.2 - Authenticated Cross-Site Scripting (XSS) via Media File Metadata
    - [xss.mp3](https://www.securify.nl/advisory/SFY20160742/xss.mp3)

## Resources

1. WordPress <= 4.9.4 - Application Denial of Service (DoS) (unpatched)
- [Link 1](https://baraktawily.blogspot.com/2018/02/how-to-dos-29-of-world-wide-websites.html)
- [Link 2](https://thehackernews.com/2018/02/wordpress-dos-exploit.html)
- [Link 3](https://wpvulndb.com/vulnerabilities/9021)
    
2. WordPress 2.5-4.6 - Authenticated Stored Cross-Site Scripting via Image Filename
- [Link 1](https://sumofpwn.nl/advisory/2016/persistent_cross_site_scripting_vulnerability_in_wordpress_due_to_unsafe_processing_of_file_names.html)
- [Link 2](https://seclists.org/fulldisclosure/2016/Sep/6)
- [Link 3](https://wpvulndb.com/vulnerabilities/8615)
    
3. WordPress 3.6.0-4.7.2 - Authenticated Cross-Site Scripting (XSS) via Media File Metadata
- [Link 1](https://sumofpwn.nl/advisory/2016/wordpress_audio_playlist_functionality_is_affected_by_cross_site_scripting.html)
- [Link 2](https://seclists.org/oss-sec/2017/q1/563)
- [Link 3](https://wpvulndb.com/vulnerabilities/8765)

4. Other
- [WordPress Source Browser](https://core.trac.wordpress.org/browser/)
- [WordPress Developer Reference](https://developer.wordpress.org/reference/)

GIFs created with [LiceCap](http://www.cockos.com/licecap/).

## Notes

Describe any challenges encountered while doing the work

Getting wpscan to work required Kali to be at its current version. The file image upload XSS attack is not possible through Windows, must use Linux because Windows limits the use of the "<" and ">" characters in filenames. Proof of concepts were often hard to visualize when attempting them.

## License

    Copyright [yyyy] [name of copyright owner]

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
